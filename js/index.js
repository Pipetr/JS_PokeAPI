/*
This assignment is about working with the Spotify API for developers.
The goal is to create a simple web application that allows users to search for artists and get information about them.
*/

// Define the variables that we will use in the code
let selecList = document.getElementById('artists');
let accessToken = '';
const clientId = '72fe3696461e4ed9ae6446576f34f8d8';
const clientSecret = '96ec0d1017024a3bbad077176b284cab';
const results = document.getElementById('results');
const genres = document.getElementById('genres');
const followers = document.getElementById('followers');
// since the API needs a artist ID, we need to get it from the search results
let artists = {
    "Pitbull": "0TnOYISbd1XYRBk9myaseg",
    "Rihanna": "5pKCCKE2ajJHZ9KAiaK11H",
    "BeyoncÃ©": "6vWDO969PvNqNYHIOW5v0m",
    "Adele": "4dpARuHxo51G3z768sgnrY",
    "Justin Bieber": "1uNFoZAHBGtllmzznpCI3s",
    "Shakira": "0EmeFodog0BfCgMzAIvKQp",
    "Michael Jackson": "3fMbdgg4jU18AjLCKBhRSm",
    "Madonna": "6tbjWDEIzxoDsBA1FuhfPW",
    "Taylor Swift": "06HL4z0CvFAxyc27GXpf02",
    "Lady Gaga": "1HY2Jd0NmPuamShAr6KMms",
    "Ariana Grande": "66CXWjxzNUsdJxJ2JdwvnR",
    "Katy Perry": "6jJ0s89eD6GaHleKKya26X",
    "Ed Sheeran": "6eUKZXaKkcviH0Ku9w2n3V",
    "Drake": "3TVXtAsR1Inumwj472S9r4",
    "Bruno Mars": "0du5cEVh5yTK9QJze8zA0C",
    "The Weeknd": "1Xyo4u8uXC1ZmMpatF05PJ",
}

// First populate the select list with the artists
for (let artist in artists) {
    let option = document.createElement('option');
    option.value = artist;
    option.text = artist;
    selecList.appendChild(option);
}

/* This piece of code was generated by Postman */
const myHeaders = new Headers();
myHeaders.append("Content-Type", "application/x-www-form-urlencoded");

const urlencoded = new URLSearchParams();
urlencoded.append("grant_type", "client_credentials");
urlencoded.append("client_id", clientId);
urlencoded.append("client_secret", clientSecret);

const requestOptions = {
    method: "POST",
    headers: myHeaders,
    body: urlencoded,
    redirect: "follow"
};


fetch("https://accounts.spotify.com/api/token", requestOptions)
    .then((response) => response.json())
    .then((result) => {
        // here we have the access token, and we can use it to make requests to the Spotify API
        accessToken = result.access_token;
    })
    .catch((error) => console.error(error));


// Now we can start working with the Spotify API
function callTheSpotifyAPI() {
    const artist = selecList.value;
    const artistId = artists[artist];
    const headers = new Headers();
    headers.append("Authorization", `Bearer ${accessToken}`);

    const requestOptions = {
    method: "GET",
    headers: headers,
    redirect: "follow"
    };
    let artistInfo = {};
    fetch("https://api.spotify.com/v1/artists/"+artistId, requestOptions)
    .then((response) => {return response.json()})
    .then((result) => {showArtistInfo(result)})
    .catch((error) => console.error(error));
}

// First we need to create a function that will search for artists
function showArtistInfo(artitstInfo) {
    // Get the artist that the user has selected
    if(artitstInfo.error) {
        alert('The artist was not found, please select a valid option');
    }else {
        // Display the artist information on the screen
        results.textContent = artitstInfo.name;
        let img = document.createElement('img');
        img.src = artitstInfo.images[2].url;
        results.appendChild(img);
        artitstInfo.genres.forEach(genre => {
            let p = document.createElement('p');
            p.textContent = genre;
            genres.appendChild(p);
        }
        );
        followers.textContent = artitstInfo.followers.total;
        
    }
}

// Add an event listener to the select list
selecList.addEventListener('change', callTheSpotifyAPI);
